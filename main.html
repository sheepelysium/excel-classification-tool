<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ç¨‹åœ–æ¨£è‡ªå‹•åˆ†é¡å™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #764ba2;
            transform: translateY(-2px);
        }
        
        .upload-area.dragover {
            border-color: #764ba2;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .results {
            margin-top: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transform: translateY(0);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            display: block;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .sample-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .sample-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }
        
        .sample-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }
        
        .sample-table th:nth-child(1), .sample-table td:nth-child(1) { width: 15%; } /* Bæ¬„ä½ */
        .sample-table th:nth-child(2), .sample-table td:nth-child(2) { width: 60%; } /* Cæ¬„ä½ */
        .sample-table th:nth-child(3), .sample-table td:nth-child(3) { width: 8%; }  /* Dæ¬„ä½ */
        .sample-table th:nth-child(4), .sample-table td:nth-child(4) { width: 17%; } /* Eæ¬„ä½ */
        
        .sample-table tr:hover {
            background: #f8f9fa;
        }
        
        .category-tag {
            display: inline-block;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            margin: 2px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .log-area {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            height: 200px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .tab-container {
            margin: 20px 0;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #667eea;
            margin-bottom: 20px;
        }
        
        .tab-button {
            background: transparent;
            border: none;
            padding: 15px 30px;
            cursor: pointer;
            font-size: 16px;
            color: #667eea;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px 10px 0 0;
        }
        
        .tab-button:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .category-detail {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #667eea;
        }
        
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .category-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .category-count {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .category-keywords {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
        
        .unclassified-list {
            max-height: 400px;
            overflow-y: auto;
            background: white;
            border-radius: 5px;
            padding: 15px;
        }
        
        .unclassified-item {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.9em;
        }
        
        .hidden {
            display: none;
        }
        
        .download-section {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
        }
        
        .download-section {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ï¸ å·¥ç¨‹åœ–æ¨£æ™ºèƒ½åˆ†é¡å™¨</h1>
        
        <div class="upload-area" id="uploadArea">
            <h3>ğŸ“ ä¸Šå‚³Excelæª”æ¡ˆ</h3>
            <p>æ‹–æ‹½æª”æ¡ˆåˆ°é€™è£¡ï¼Œæˆ–é»æ“Šé¸æ“‡æª”æ¡ˆ</p>
            <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">
            <button class="btn" onclick="document.getElementById('fileInput').click()">é¸æ“‡æª”æ¡ˆ</button>
        </div>
        
        <div class="progress-bar hidden" id="progressBar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="log-area hidden" id="logArea"></div>
        
        <div class="results hidden" id="results">
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="showTab('overview')">ğŸ“Š ç¸½è¦½çµ±è¨ˆ</button>
                    <button class="tab-button" onclick="showTab('categories')">ğŸ·ï¸ åˆ†é¡è©³æƒ…</button>
                    <button class="tab-button" onclick="showTab('unclassified')">â“ æœªåˆ†é¡é …ç›®</button>
                    <button class="tab-button" onclick="showTab('samples')">ğŸ“‹ è³‡æ–™é è¦½</button>
                </div>
                
                <div id="tab-overview" class="tab-content active">
                    <h2>ğŸ“Š åˆ†é¡çµ±è¨ˆç¸½è¦½</h2>
                    <div class="stats-grid" id="statsGrid"></div>
                </div>
                
                <div id="tab-categories" class="tab-content">
                    <h2>ğŸ·ï¸ è©³ç´°åˆ†é¡çµ±è¨ˆ</h2>
                    <div id="categoryDetails"></div>
                </div>
                
                <div id="tab-unclassified" class="tab-content">
                    <h2>â“ æœªåˆ†é¡é …ç›®è©³æƒ…</h2>
                    <div id="unclassifiedDetails"></div>
                </div>
                
                <div id="tab-samples" class="tab-content">
                    <h2>ğŸ“‹ åˆ†é¡æ¨£æœ¬é è¦½</h2>
                    <table class="sample-table" id="sampleTable">
                        <thead>
                            <tr>
                                <th>å·¥ç¨‹åç¨±</th>
                                <th>åœ–æ¨£å…§å®¹</th>
                                <th>åœ–è™Ÿ</th>
                                <th>åˆ†é¡çµæœ</th>
                            </tr>
                        </thead>
                        <tbody id="sampleTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="download-section">
                <h3>ğŸ’¾ ä¸‹è¼‰åˆ†é¡çµæœ</h3>
                <button class="btn" id="downloadBtn">ä¸‹è¼‰Excelæª”æ¡ˆ</button>
                <button class="btn" id="downloadCsvBtn">ä¸‹è¼‰CSVæª”æ¡ˆ</button>
            </div>
        </div>
    </div>

    <script>
        // åˆ†é¡è¦å‰‡ - ä¿ç•™åŸæœ‰32é¡ + æ•´åˆAIå»ºè­°æ–°å¢
        const classificationRules = {
            // === åŸæœ‰åœ–é¢é¡å‹ï¼ˆä¿ç•™+å¾®èª¿ï¼‰ ===
            "å¹³é¢åœ–": ["å¹³é¢åœ–", "é…ç½®åœ–", "ä½ç½®åœ–", "ä½ˆç½®åœ–", "layout", "å¹³é¢", "å¹³ç¸±é¢åœ–", "å¹³é¢åŠç¸±é¢åœ–", "å¹³é¢åŠç¸±å¡åœ–"],
            "æ¨™æº–æ–·é¢": ["æ–·é¢åœ–", "å‰–é¢åœ–", "æ©«æ–·é¢", "æ¨™æº–æ–·é¢", "section", "æ©«æ®µé¢", "æ©«æ–­é¢"], // ä¿ç•™åŸæœ‰+æ–°å¢æ©«æ–·é¢è®Šé«”
            "ç¸±é¢åœ–": ["ç¸±é¢åœ–", "ç¸±å¡åœ–", "ç¸±æ–·é¢åœ–", "profile"], // ã€æ–°å¢ã€‘å¾æ¨™æº–æ–·é¢åˆ†é›¢å‡ºä¾†
            "ç«‹é¢åœ–": ["ç«‹é¢åœ–", "æ­£é¢åœ–", "å´é¢åœ–", "elevation"],
            "è©³åœ–": ["è©³åœ–", "å¤§æ¨£åœ–", "ç¯€é»åœ–", "æ§‹é€ è©³åœ–", "detail", "ç¥¥åœ–"], // æ–°å¢"ç¥¥åœ–"
            "ç«£å·¥åœ–": ["ç«£å·¥åœ–", "å®Œå·¥åœ–", "as-built"],
            "æ–½å·¥åœ–": ["æ–½å·¥åœ–", "æ–½å·¥èªªæ˜", "construction"],
            "ç¤ºæ„åœ–": ["ç¤ºæ„åœ–", "å±•é–‹åœ–", "æ§åˆ¶åœ–", "æŒ‡ç¤ºåœ–", "ç¤ºæ„", "ä½ˆè¨­åœ–"], // æ–°å¢è®Šé«”
            "è¨­è¨ˆåœ–": ["è¨­è¨ˆåœ–", "ç´°éƒ¨è¨­è¨ˆ", "é›¶ä»¶åœ–", "é›¶ä»¶", "çµ„ç«‹åœ–"], // ã€æ–°å¢ã€‘AIå»ºè­°
            
            // === åŸæœ‰çµæ§‹å·¥ç¨‹ï¼ˆä¿ç•™+ç´°åˆ†ï¼‰ ===
            "æ©‹æ¨‘å·¥ç¨‹": ["æ©‹", "æ©‹å°", "æ©‹å¢©", "æ©‹é¢", "æ©‹æ¢", "bridge"],
            "ä¸Šéƒ¨çµæ§‹": ["ä¸Šéƒ¨çµæ§‹", "æ¨‘", "æ¢", "æ‹±åº¦", "é åŠ›", "ç®±å‹æ¢", "é‹¼æ¢", "P.C.", "å´—æ”¯æ¨‘", "æ‡¸è‡‚æ¢"], // ã€æ–°å¢ã€‘AIå»ºè­°
            "éš§é“å·¥ç¨‹": ["éš§é“", "æ¶µæ´", "é€šé“", "tunnel", "æ´å£", "ç®¡å¹•"], // æ–°å¢"ç®¡å¹•"
            "æ“‹åœŸå·¥ç¨‹": ["æ“‹åœŸç‰†", "è­·å¡", "é‚Šå¡", "æ“‹åœŸ", "retaining", "ä¿è­·å·¥", "è­·å²¸", "å›ºåºŠå·¥"], // æ–°å¢è®Šé«”
            
            // === åŸæœ‰é“è·¯å·¥ç¨‹ï¼ˆä¿ç•™+æ–°å¢ï¼‰ ===
            "é“è·¯å·¥ç¨‹": ["è·¯é¢", "è»Šé“", "è·¯åŸº", "è·¯è‚©", "äººè¡Œé“", "é“è·¯", "è·¯ç·š", "å¿«é€Ÿå…¬è·¯", "æ‹“å¯¬"], // æ–°å¢è®Šé«”
            "è·¯ç·šè¨­è¨ˆ": ["æ›²ç·š", "è¶…é«˜", "ç·šå½¢", "åŒé“", "äº¤æµé“", "è¯çµ¡é“", "è¾²è·¯", "å¼•é“", "æ§½åŒ–"], // ã€æ–°å¢ã€‘AIå»ºè­°
            "äº¤é€šè¨­æ–½": ["æ¨™èªŒ", "æ¨™ç·š", "è™ŸèªŒ", "è­·æ¬„", "æ¬„æ†", "äº¤é€š", "å®‰å…¨è¨­æ–½", "å€’æ•¸ç‡ˆ", "å°æ¨™", "é‡Œç¨‹ç‰Œ"], // æ–°å¢è®Šé«”
            "æ’æ°´å·¥ç¨‹": ["æ’æ°´", "ä¸‹æ°´é“", "é›¨æ°´", "é›†æ°´", "æºæ¸ ", "drainage", "æºè“‹", "æ°´æº", "é‚Šæº", "æš—æº", "æ˜æº", "Uæº", "ç®±æ¶µ", "æ»¯æ´ª", "æ²‰ç ‚æ± "], // æ–°å¢å¤§é‡è®Šé«”
            
            // === åŸæœ‰ææ–™çµæ§‹ï¼ˆä¿ç•™ï¼‰ ===
            "é‹¼ç­‹": ["é‹¼ç­‹", "é…ç­‹", "é‹¼ç­‹åœ–", "reinforcement", "é‹¼ç­‹é…ç½®", "è£œå¼·ç­‹"],
            "åœ°è³ªé‘½æ¢": ["åœ°è³ª", "é‘½æ¢", "åœ°è³ªèª¿æŸ¥", "é‘½å­”", "åœŸå£¤", "åœ°ç›¤"],
            "åŸºç¤å‹å¼": ["åŸºç¤", "æ¨åŸº", "åŸºæ¨", "åŸºç¤ç‰ˆ", "foundation", "åŸºè…³", "æ‰¿å°", "æ¨ä½", "åœ°éŒ¨", "åŸºåº§", "é–‹æŒ–"],
            "æ··å‡åœŸçµæ§‹": ["æ··å‡åœŸ", "é åŠ›", "é é‘„", "concrete", "RC"],
            "æ”¯æ‰¿ç³»çµ±": ["æ”¯æ‰¿", "ä¼¸ç¸®ç¸«", "æ­¢éœ‡", "bearing", "æ”¯æ‰¿å¢Š"],
            
            // === åŸæœ‰ç’°å¢ƒæ™¯è§€ï¼ˆä¿ç•™ï¼‰ ===
            "æ™¯è§€å·¥ç¨‹": ["æ¤æ ½", "ç¶ åŒ–", "æ™¯è§€", "ç¶ çŸ³", "landscape", "ç¾åŒ–", "æ¤ç”Ÿ"],
            "ç’°å¢ƒä¿è­·": ["ç’°ä¿", "æ°´åœŸä¿æŒ", "ç”Ÿæ…‹", "å¾©è‚²", "éš”éŸ³ç‰†", "æŸµæ¬„", "é˜²è½çŸ³"], // æ–°å¢éš”éŸ³ç‰†ç­‰
            
            // === åŸæœ‰æ–½å·¥ç®¡ç†ï¼ˆä¿ç•™ï¼‰ ===
            "æ–½å·¥æ–¹æ³•": ["æ–½å·¥æ–¹æ³•", "å·¥æ³•", "æ–½å·¥ç¨‹åº", "å·¥åº", "ç€é’", "æ–½å·¥æµç¨‹"], // æ–°å¢è®Šé«”
            "è‡¨æ™‚å·¥ç¨‹": ["è‡¨æ™‚", "æ”¯æ’", "åœå °", "è‡¨æ™‚æ©‹", "ä¾¿é“", "æ´—è»Šå°", "æ–½å·¥æ¶"], // æ–°å¢è®Šé«”
            "å“è³ªç®¡åˆ¶": ["å“ç®¡", "å“è³ª", "æª¢é©—", "è©¦é©—", "å“è³ªç®¡åˆ¶"],
            
            // === æ©Ÿé›»ç³»çµ±ï¼ˆåŸæœ‰1é¡â†’ç´°åˆ†ç‚º5é¡ï¼‰ ===
            "é›»åŠ›ç³»çµ±": ["å–®ç·šåœ–", "è² è¼‰è¡¨", "å£“é™", "é…é›»ç®±", "é–‹é—œç®±", "è² è¼‰åˆ†æ", "ç³»çµ±åœ–", "é›»åŠ›"], // ã€æ–°å¢ã€‘ç´°åˆ†
            "å¼±é›»ç³»çµ±": ["å¼±é›»", "ç›£è¦–", "é€šè¨Š", "å»£æ’­", "è»Šè¼›ç®¡åˆ¶", "CMS", "LCS", "æ¶æ§‹åœ–", "è»Šç‰Œè¾¨è­˜"], // ã€æ–°å¢ã€‘ç´°åˆ†
            "ç…§æ˜è¨­å‚™": ["ç…§æ˜", "è·¯ç‡ˆ", "LED", "ç‡ˆç®±", "ç‡ˆåº§", "è¡Œäººç‡ˆ"], // ã€æ–°å¢ã€‘ç´°åˆ†
            "æ¶ˆé˜²è¨­å‚™": ["æ¶ˆé˜²", "è­¦å ±", "æ¶ˆé˜²æ “", "æ¶ˆé˜²è¨­å‚™", "æ˜‡ä½åœ–"], // ã€æ–°å¢ã€‘ç´°åˆ†
            "æ©Ÿé›»è¨­å‚™": ["æ©Ÿé›»", "é›»æ°£", "æ§åˆ¶å™¨", "æ¥ç·šç®±", "é…ä»¶", "ç©ºèª¿", "é€šé¢¨"], // ã€ä¿ç•™ã€‘å…¶ä»–æ©Ÿé›»
            "æ’æ°´æ©Ÿé›»": ["æŠ½æ°´", "æ³µæµ¦", "æ©Ÿæ¢°", "é›»æ©Ÿ"], // ã€ä¿ç•™ã€‘åŸæœ‰
            
            // === åŸæœ‰æ¸¬é‡è¦åŠƒï¼ˆä¿ç•™ï¼‰ ===
            "æ¸¬é‡æ§åˆ¶": ["å°ç·šç¶²", "æ°´æº–ç¶²", "æ§åˆ¶é»", "æ¨ä½", "æ¸¬é‡", "æ§åˆ¶ç¶²"],
            "éƒ½å¸‚è¨ˆç•«": ["éƒ½å¸‚è¨ˆç•«", "è¨ˆç•«åœ–", "ç”¨åœ°", "è·¯æ¬Šåœ–", "è·¯æ¬Š"], // æ–°å¢è·¯æ¬Šç›¸é—œ
            "ç‰¹æ®Šææ–™": ["æ ¼æŸµéˆ‘", "éé‹…", "é‡‘å±¬", "å¸éš”éŸ³", "ææ–™è¦æ ¼", "æ ¼æŸµ", "è“‹ç‰ˆ", "è“‹æ¿", "é‘„éµè“‹"], // æ–°å¢è®Šé«”
            "éŒ¨å›ºå·¥ç¨‹": ["éŒ¨ç­‹", "çŒæ¼¿", "åœ°éŒ¨", "éŒ¨å›º"],
            
            // === åŸæœ‰æ–‡ä»¶è³‡æ–™ï¼ˆä¿ç•™+æ–°å¢ï¼‰ ===
            "èªªæ˜æ–‡ä»¶": ["èªªæ˜", "åœ–ä¾‹", "ç›®éŒ„", "å°é¢", "åœ–ç›®éŒ„", "specification", "ç¸½èªªæ˜", "ç´¢å¼•", "å°ç…§è¡¨", "æ¦‚è¦"], // æ–°å¢è®Šé«”
            "å·¥ç¨‹æ•¸é‡": ["æ•¸é‡è¡¨", "å·¥ç¨‹æ•¸é‡", "ææ–™è¡¨", "quantity", "çµ±è¨ˆè¡¨", "çµ±è¨ˆè©³è¡¨", "æ•¸é‡çµ±è¨ˆ"], // æ–°å¢è®Šé«”
            "å·¥ç¨‹è¦ç¯„": ["è¦ç¯„", "æ¨™æº–", "æº–å‰‡", "è¦å®š", "æ³¨æ„äº‹é …"], // æ–°å¢è®Šé«”
            "è¨­ç½®è¡¨": ["è¨­ç½®è¡¨", "é…ç½®è¡¨", "ä½ç½®è¡¨", "ä¸€è¦½è¡¨", "è¨­å‚™è¡¨"], // ã€æ–°å¢ã€‘AIå»ºè­°
            
            // === åŸºæ–¼æ–‡ä»¶è³‡æ–™æ–°å¢çš„ç‰¹æ®Šé¡å‹ ===
            "ç¶²ç‹€åœ–": ["ç¶²ç‹€åœ–", "ç«£å·¥ç¶²ç‹€åœ–"], // ã€æ–°å¢ã€‘
            "é«˜ç¨‹è³‡æ–™": ["é«˜ç¨‹ç¸½è¡¨", "é«˜ç¨‹"], // ã€æ–°å¢ã€‘
            "ç½å®³ä¿®å¾©": ["ç½å®³ä¿®å¾©", "åæ–¹æ¸…é™¤", "ä¿®å¾©å·¥ç¨‹", "ä¿®å¾©"], // ã€æ–°å¢ã€‘
            "ç®¡ç·šå·¥ç¨‹": ["ç®¡ç·š", "ç®¡è·¯", "é åŸ‹ç®¡", "ç®¡æ¶µ"], // ã€æ–°å¢ã€‘
            "åœŸçŸ³è™•ç†": ["æ¡å–åœŸçŸ³", "é¤˜åœŸå †ç½®", "åœŸæ–¹å¡«ç¯‰"], // ã€æ–°å¢ã€‘
            "æ©Ÿæ¢°è¨­å‚™": ["æšå™¨", "å‚˜å‹é½’è¼ª", "æ‰˜æ¶", "æ“´åº§"], // ã€æ–°å¢ã€‘
            "å·¥ç¨‹ç®¡ç†": ["å·¥ç¨‹å‘Šç¤ºç‰Œ", "å‹å·¥å®‰å…¨", "å‹å®‰", "å®‰å…¨è¡›ç”Ÿ", "å‘Šç¤ºç‰Œ", "åœç±¬"] // ã€æ–°å¢ã€‘å¾åŸç’°å¢ƒä¿è­·åˆ†é›¢
        };
        
        let processedData = [];
        let originalData = [];
        
        // è‡ªå‹•åˆ†é¡å‡½æ•¸
        function autoClassify(content) {
            const results = [];
            for (const [category, keywords] of Object.entries(classificationRules)) {
                if (keywords.some(keyword => content.includes(keyword))) {
                    results.push(category);
                }
            }
            return results.length > 0 ? results : ["æœªåˆ†é¡"];
        }
        
        // è¨˜éŒ„æ—¥èªŒ
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.innerHTML += `[${timestamp}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        // æ›´æ–°é€²åº¦æ¢
        function updateProgress(percent) {
            document.getElementById('progressFill').style.width = percent + '%';
        }
        
        // è™•ç†æ–‡ä»¶ä¸Šå‚³
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                processFile(file);
            }
        });
        
        // æ‹–æ‹½ä¸Šå‚³
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) {
                processFile(file);
            }
        });
        
        // è™•ç†Excelæª”æ¡ˆ
        function processFile(file) {
            document.getElementById('progressBar').classList.remove('hidden');
            document.getElementById('logArea').classList.remove('hidden');
            
            log(`é–‹å§‹è™•ç†æª”æ¡ˆ: ${file.name}`);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    log(`æª”æ¡ˆè®€å–æˆåŠŸï¼Œå·¥ä½œè¡¨: ${workbook.SheetNames.join(', ')}`);
                    
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                    
                    log(`ç¸½å…± ${jsonData.length} è¡Œè³‡æ–™`);
                    updateProgress(20);
                    
                    // æå–Cæ¬„ä½è³‡æ–™ä¸¦åˆ†é¡
                    originalData = [];
                    processedData = [];
                    
                    for (let i = 1; i < jsonData.length; i++) {
                        if (jsonData[i] && jsonData[i][2]) {
                            const content = jsonData[i][2].toString().trim();
                            const categories = autoClassify(content);
                            
                            const rowData = {
                                row: i + 1,
                                originalContent: content,
                                categories: categories,
                                fullRow: jsonData[i]
                            };
                            
                            originalData.push(jsonData[i]);
                            processedData.push(rowData);
                        }
                        
                        if (i % 1000 === 0) {
                            updateProgress(20 + (i / jsonData.length) * 60);
                            log(`å·²è™•ç† ${i} ç­†è³‡æ–™...`);
                        }
                    }
                    
                    updateProgress(80);
                    log(`åˆ†é¡å®Œæˆï¼å…±è™•ç† ${processedData.length} ç­†è³‡æ–™`);
                    
                    // é¡¯ç¤ºçµæœ
                    displayResults();
                    updateProgress(100);
                    log(`è™•ç†å®Œæˆï¼`);
                    
                } catch (error) {
                    log(`éŒ¯èª¤: ${error.message}`);
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // é¡¯ç¤ºæ¨™ç±¤é 
        function showTab(tabName) {
            // éš±è—æ‰€æœ‰æ¨™ç±¤å…§å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„activeç‹€æ…‹
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
        }
        
        // é¡¯ç¤ºåˆ†é¡çµæœ
        function displayResults() {
            document.getElementById('results').classList.remove('hidden');
            
            // çµ±è¨ˆåˆ†é¡çµæœ
            const categoryStats = {};
            const unclassifiedItems = [];
            
            processedData.forEach(item => {
                item.categories.forEach(cat => {
                    categoryStats[cat] = (categoryStats[cat] || 0) + 1;
                });
                
                if (item.categories.includes('æœªåˆ†é¡')) {
                    unclassifiedItems.push(item);
                }
            });
            
            // é¡¯ç¤ºç¸½è¦½çµ±è¨ˆ
            displayOverviewStats(categoryStats);
            
            // é¡¯ç¤ºè©³ç´°åˆ†é¡
            displayCategoryDetails(categoryStats);
            
            // é¡¯ç¤ºæœªåˆ†é¡é …ç›®
            displayUnclassifiedDetails(unclassifiedItems);
            
            // é¡¯ç¤ºæ¨£æœ¬è³‡æ–™
            displaySampleData();
            
            // è¨­å®šä¸‹è¼‰æŒ‰éˆ•
            setupDownloadButtons();
        }
        
        // é¡¯ç¤ºç¸½è¦½çµ±è¨ˆ
        function displayOverviewStats(categoryStats) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = '';
            
            // ç¸½æ•¸æ“šå¡ç‰‡
            statsGrid.innerHTML += `
                <div class="stat-card">
                    <span class="stat-number">${processedData.length}</span>
                    <span class="stat-label">ç¸½ç­†æ•¸</span>
                </div>
            `;
            
            // åˆ†é¡æ•¸é‡å¡ç‰‡
            const totalCategories = Object.keys(categoryStats).length;
            statsGrid.innerHTML += `
                <div class="stat-card">
                    <span class="stat-number">${totalCategories}</span>
                    <span class="stat-label">åˆ†é¡ç¨®é¡</span>
                </div>
            `;
            
            // æœªåˆ†é¡æ•¸é‡å¡ç‰‡
            const unclassifiedCount = categoryStats['æœªåˆ†é¡'] || 0;
            statsGrid.innerHTML += `
                <div class="stat-card">
                    <span class="stat-number">${unclassifiedCount}</span>
                    <span class="stat-label">æœªåˆ†é¡ (${((unclassifiedCount/processedData.length)*100).toFixed(1)}%)</span>
                </div>
            `;
            
            // å‰5å¤§åˆ†é¡
            const top5Categories = Object.entries(categoryStats)
                .filter(([cat]) => cat !== 'æœªåˆ†é¡')
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
                
            top5Categories.forEach(([category, count]) => {
                const percentage = ((count / processedData.length) * 100).toFixed(1);
                statsGrid.innerHTML += `
                    <div class="stat-card">
                        <span class="stat-number">${count}</span>
                        <span class="stat-label">${category} (${percentage}%)</span>
                    </div>
                `;
            });
        }
        
        // é¡¯ç¤ºè©³ç´°åˆ†é¡çµ±è¨ˆ
        function displayCategoryDetails(categoryStats) {
            const categoryDetails = document.getElementById('categoryDetails');
            categoryDetails.innerHTML = '';
            
            // æŒ‰æ•¸é‡æ’åºæ‰€æœ‰åˆ†é¡
            const sortedCategories = Object.entries(categoryStats)
                .sort(([,a], [,b]) => b - a);
            
            sortedCategories.forEach(([category, count]) => {
                const percentage = ((count / processedData.length) * 100).toFixed(1);
                
                // ç²å–è©²åˆ†é¡çš„é—œéµå­—
                const keywords = classificationRules[category] || ['ç³»çµ±è‡ªå‹•åˆ†é¡'];
                
                categoryDetails.innerHTML += `
                    <div class="category-detail">
                        <div class="category-header">
                            <span class="category-name">${category}</span>
                            <span class="category-count">${count} ç­† (${percentage}%)</span>
                        </div>
                        <div class="category-keywords">
                            é—œéµå­—: ${keywords.join(', ')}
                        </div>
                    </div>
                `;
            });
        }
        
        // é¡¯ç¤ºæœªåˆ†é¡é …ç›®è©³æƒ…
        function displayUnclassifiedDetails(unclassifiedItems) {
            const unclassifiedDetails = document.getElementById('unclassifiedDetails');
            
            if (unclassifiedItems.length === 0) {
                unclassifiedDetails.innerHTML = `
                    <div class="category-detail">
                        <h3 style="color: #27ae60;">ğŸ‰ å¤ªæ£’äº†ï¼æ‰€æœ‰é …ç›®éƒ½å·²æˆåŠŸåˆ†é¡ï¼</h3>
                        <p>æ²’æœ‰æœªåˆ†é¡çš„é …ç›®ï¼Œåˆ†é¡ç³»çµ±é‹ä½œå®Œç¾ï¼</p>
                    </div>
                `;
                return;
            }
            
            unclassifiedDetails.innerHTML = `
                <div class="category-detail">
                    <div class="category-header">
                        <span class="category-name">æœªåˆ†é¡é …ç›®</span>
                        <span class="category-count">${unclassifiedItems.length} ç­†</span>
                    </div>
                    <p>ä»¥ä¸‹é …ç›®æœªèƒ½è‡ªå‹•åˆ†é¡ï¼Œå¯èƒ½éœ€è¦æ–°å¢é—œéµå­—æˆ–å»ºç«‹æ–°çš„åˆ†é¡è¦å‰‡ï¼š</p>
                    <div class="unclassified-list">
                        ${unclassifiedItems.map((item, index) => 
                            `<div class="unclassified-item">${index + 1}. ${item.originalContent}</div>`
                        ).join('')}
                    </div>
                </div>
            `;
        }
        
        // é¡¯ç¤ºæ¨£æœ¬è³‡æ–™
        function displaySampleData() {
            const sampleTableBody = document.getElementById('sampleTableBody');
            sampleTableBody.innerHTML = '';
            
            // é¡¯ç¤ºå‰50ç­†ä½œç‚ºæ¨£æœ¬
            processedData.slice(0, 50).forEach((item, index) => {
                const categoryTags = item.categories.map(cat => 
                    `<span class="category-tag">${cat}</span>`
                ).join('');
                
                sampleTableBody.innerHTML += `
                    <tr>
                        <td>${item.fullRow[1] || ''}</td>
                        <td>${item.originalContent}</td>
                        <td>${item.fullRow[3] || ''}</td>
                        <td>${categoryTags}</td>
                    </tr>
                `;
            });
        }
        
        // è¨­å®šä¸‹è¼‰åŠŸèƒ½
        function setupDownloadButtons() {
            document.getElementById('downloadBtn').onclick = function() {
                downloadExcel();
            };
            
            document.getElementById('downloadCsvBtn').onclick = function() {
                downloadCSV();
            };
        }
        
        // ä¸‹è¼‰Excelæª”æ¡ˆ
        function downloadExcel() {
            const wb = XLSX.utils.book_new();

            // === ç¬¬ä¸€å€‹åˆ†é ï¼šåˆ†é¡çµæœ (èª¿æ•´æ¬„ä½å¯¬åº¦) ===
            const ws_data = [['å·¥ç¨‹åç¨±', 'åœ–æ¨£å…§å®¹', 'åœ–è™Ÿ', 'åˆ†é¡çµæœ']];
            processedData.forEach((item) => {
                ws_data.push([
                    item.fullRow[1] || '',
                    item.originalContent,
                    item.fullRow[3] || '',
                    item.categories.join(', ')
                ]);
            });
            const ws_main = XLSX.utils.aoa_to_sheet(ws_data);
            ws_main['!cols'] = [
                { wch: 25 * 3 }, // å·¥ç¨‹åç¨± (Bæ¬„ä½)
                { wch: 25 * 3 }, // åœ–æ¨£å…§å®¹ (Cæ¬„ä½)
                { wch: 25 },     // åœ–è™Ÿ (Dæ¬„ä½)
                { wch: 25 * 2 }  // åˆ†é¡çµæœ (Eæ¬„ä½)
            ];
            XLSX.utils.book_append_sheet(wb, ws_main, "åˆ†é¡çµæœ");

            // === ç¬¬äºŒå€‹åˆ†é ï¼šåˆ†é¡çµ±è¨ˆè©³æƒ… (èª¿æ•´æ¬„ä½å¯¬åº¦) ===
            const categoryStats = {};
            processedData.forEach(item => {
                item.categories.forEach(cat => {
                    categoryStats[cat] = (categoryStats[cat] || 0) + 1;
                });
            });

            const stats_data = [['åˆ†é¡åç¨±', 'æ•¸é‡', 'ç™¾åˆ†æ¯”', 'é—œéµå­—åˆ—è¡¨']];
            Object.entries(categoryStats)
                .sort(([, a], [, b]) => b - a)
                .forEach(([category, count]) => {
                    const percentage = ((count / processedData.length) * 100).toFixed(1) + '%';
                    const keywords = classificationRules[category] ?
                        classificationRules[category].join(', ') : 'ç³»çµ±è‡ªå‹•åˆ†é¡';

                    stats_data.push([category, count, percentage, keywords]);
                });

            const ws_stats = XLSX.utils.aoa_to_sheet(stats_data);
            ws_stats['!cols'] = [
                { wch: 20 },
                { wch: 10 },
                { wch: 10 },
                { wch: 25 * 8 } // é—œéµå­—åˆ—è¡¨
            ];
            XLSX.utils.book_append_sheet(wb, ws_stats, "åˆ†é¡çµ±è¨ˆè©³æƒ…");

            // === ç¬¬ä¸‰å€‹åˆ†é ï¼šæœªåˆ†é¡é …ç›® (ç§»é™¤æ¬„ä½ä¸¦èª¿æ•´å¯¬åº¦) ===
            const unclassified_data = [['å·¥ç¨‹åç¨±', 'åœ–æ¨£å…§å®¹', 'åœ–è™Ÿ']];
            processedData.forEach((item) => {
                if (item.categories.includes('æœªåˆ†é¡')) {
                    unclassified_data.push([
                        item.fullRow[1] || '',
                        item.originalContent,
                        item.fullRow[3] || ''
                    ]);
                }
            });

            const ws_unclassified = XLSX.utils.aoa_to_sheet(unclassified_data);
            ws_unclassified['!cols'] = [
                { wch: 25 * 3 }, // å·¥ç¨‹åç¨±
                { wch: 25 * 3 }, // åœ–æ¨£å…§å®¹
                { wch: 25 }      // åœ–è™Ÿ
            ];
            XLSX.utils.book_append_sheet(wb, ws_unclassified, "æœªåˆ†é¡é …ç›®");

            // === ç¬¬å››å€‹åˆ†é ï¼šåˆ†é¡è¦å‰‡åƒè€ƒ (èª¿æ•´å¯¬åº¦ä¸¦ç§»é™¤æ¬„ä½) ===
            const rules_data = [['åˆ†é¡åç¨±', 'é—œéµå­—']];
            Object.entries(classificationRules).forEach(([category, keywords]) => {
                rules_data.push([
                    category,
                    keywords.join(', ')
                ]);
            });

            const ws_rules = XLSX.utils.aoa_to_sheet(rules_data);
            ws_rules['!cols'] = [
                { wch: 25 * 2 }, // åˆ†é¡åç¨±
                { wch: 25 * 5 }  // é—œéµå­—
            ];
            XLSX.utils.book_append_sheet(wb, ws_rules, "åˆ†é¡è¦å‰‡åƒè€ƒ");

            XLSX.writeFile(wb, 'å·¥ç¨‹åœ–æ¨£åˆ†é¡çµæœ_å®Œæ•´ç‰ˆ.xlsx');
            log('Excelæª”æ¡ˆä¸‹è¼‰å®Œæˆï¼åŒ…å«4å€‹åˆ†é ï¼šåˆ†é¡çµæœã€çµ±è¨ˆè©³æƒ…ã€æœªåˆ†é¡é …ç›®ã€åˆ†é¡è¦å‰‡');
        }

        // ä¸‹è¼‰CSVæª”æ¡ˆ
        function downloadCSV() {
            let csvContent = "å·¥ç¨‹åç¨±,åœ–æ¨£å…§å®¹,åœ–è™Ÿ,åˆ†é¡çµæœ\n";

            processedData.forEach((item) => {
                const safeString = (value) => {
                    if (value === null || value === undefined) return '';
                    return String(value).replace(/"/g, '""');
                };

                const row = [
                    `"${safeString(item.fullRow[1])}"`,
                    `"${safeString(item.originalContent)}"`,
                    `"${safeString(item.fullRow[3])}"`,
                    `"${safeString(item.categories.join(', '))}"`
                ].join(',');
                csvContent += row + "\n";
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "å·¥ç¨‹åœ–æ¨£åˆ†é¡çµæœ.csv";
            link.click();
            log('CSVæª”æ¡ˆä¸‹è¼‰å®Œæˆï¼');
        }
    </script>
</body>
</html>